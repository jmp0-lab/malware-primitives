#include <windows.h>
#include <stdio.h>
#include "misc.h"


void xorKey(PBYTE pData, SIZE_T sDataSize, PBYTE pKey, SIZE_T sKeySize)
{
	for (size_t i = 0, j = 0; i < sDataSize; i++, j++)
	{
		if (j >= sKeySize)
		{
			j = 0;
		}

		pData[i] = pData[i] ^ pKey[j];
	}
}

int main()
{
	// msfvenom -p windows/exec CMD=notepad.exe -f c
	BYTE bufEnc[] =
		"\x57\x25\x6d\xf0\x0f\xab\xad\x66\x15\x3e\x6b\xa9\x64\xa0\x3f\x20"
		"\x9f\xe3\x7b\x5d\xbf\x46\x9d\xd8\x00\x1c\x87\xc9\xc1\xf0\x07\xf1"
		"\x8e\x8c\x0d\x87\xed\x2e\x3f\x02\xaa\x0a\x0d\x02\x5d\xfc\x46\xbd"
		"\xe0\x84\xe1\xf1\x64\xbc\x1e\xd3\x2e\xa7\xf1\xde\xfa\x46\xb6\xd0"
		"\x0e\x78\x46\xa6\xe8\xec\x91\x84\x64\xc4\x84\xaa\x1b\xde\x0f\xa3"
		"\x6a\x02\xe2\xf1\xc8\x93\x2d\x9a\x06\x0c\xd6\x35\xd4\x8d\x2b\xde"
		"\x29\xb7\x7b\x57\x8f\xcc\x3c\x96\x84\xa7\x86\x64\xa8\x13\xaa\x1e"
		"\x64\xf4\x84\xaa\x1d\x66\xb4\x2b\x8f\x96\xb4\x91\x56\xf1\x9c\x10"
		"\x10\x50\xf4\x97\x64\xe2\xe4\x26\x90\x85\xf1\x82\x2e\x7f\xef\xf0"
		"\x0f\xfb\xa5\xde\x7b\x60\x2c\x32\x3a\x4b\xff\x1e\x6f\xb9\x98\xa9"
		"\x3e\x70\x72\x0f\xda\x97\xcb\x93\xfa\x8f\x50\x2d\x9a\xf5\xb4\xec"
		"\xde\x9d\x9f\x65\xab\x9e\x10\x25\x61\xc4\xb9\x8a\x80\x6e\xcf\xe3"
		"\x8a\x88\x6a\xab";

	SIZE_T sBufEnc = (sizeof(bufEnc) / sizeof(BYTE)) - 1;

	BYTE key[] = "\xAB\xCD\xEF\xF0\x0F";
	SIZE_T sKey = (sizeof(key) / sizeof(BYTE)) - 1;

	printHex(bufEnc, sBufEnc);

	xorKey(bufEnc, sBufEnc,key, sKey);

	printHex(bufEnc, sBufEnc);


	return 0;
}