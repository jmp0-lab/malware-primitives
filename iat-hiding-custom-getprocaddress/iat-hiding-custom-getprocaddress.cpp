#include <Windows.h>
#include "misc.h"
#include "iat-hiding-custom-getprocaddress-lib.h"
#include "iat-hiding-custom-getmodulehandle-lib.h"

#define MODNAME L"kernel32.dll"
// kernel32.dll -> djb_hash: 0x9ef6cca9

#define PROCNAME "Beep"
// beep -> djb_hash: 0x5eb971f5

typedef NTSTATUS(NTAPI* fnBeep)
(
	DWORD dwFreq,
	DWORD dwDuration
);

int main()
{
	PVOID pFunOrig = GetProcAddress(GetModuleHandle(MODNAME), PROCNAME);
	wprintf(L"[*] GetModuleHandle Original: 0x%p\n", pFunOrig);
	
	PVOID pFunCustom = GetProcAddressCustom(GetModuleHandle(MODNAME), 0x5eb971f5);
	wprintf(L"[*] GetModuleHandle Custom: 0x%p\n", pFunCustom);

	PVOID pFunCustomCustom = GetProcAddressCustom(GetModuleHandleCustom(0x9ef6cca9), 0x5eb971f5);
	wprintf(L"[*] GetModuleHandle Custom: 0x%p\n", pFunCustomCustom);

	fnBeep pBeep = (fnBeep)pFunCustomCustom;
	pBeep(750, 300);

	return 0;
}
